<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Project</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_projects.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/projects.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/general.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">

  <style>

    </style>
</head>
<body>
   <section class="header">
        <nav class="navbar">
            <div class="logo">
                <a href="{{url_for ('home')}}">
                    <img src="{{ url_for('static', filename='photos/logo.jpg') }}" alt="Logo" class="logo-img">
                </a>
            </div>
            <div class="pages">
                <ul>
                          <li><a href="{{ url_for ('about') }}">About Us</a></li>
                          <li><a href="{{ url_for('markets') }}">Markets & Services</a></li>
                          <li><a href="{{ url_for('show_projects') }}">Projects</a></li>
                          <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
                </ul>
            </div>
            <div class="dropdown">
                <div class="menu">
                    <div id="myNav" class="overlay">
                        <a href="javascript:void(0)" class="closebtn">&times;</a>
                    </div>
                    <div>
                        <a href="javascript:void(0)" class="openbtn">
                            <div class="one"></div>
                            <div class="two"></div>
                            <div class="three"></div>
                        </a>
                    </div>
                    <div class="dropdown-content">
                        <ul>
                            <li><a href="{{url_for ('home')}}">Home</a></li>
                            <li><a href="{{ url_for ('about') }}">About Us</a></li>
                            <li><a href="{{ url_for('markets') }}">Markets & Services</a></li>
                            <li><a href="{{ url_for('show_projects') }}">Projects</a></li>
                            <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </section>
    <section class="cover-section-2">
        <div class="cover-text-2">
            <p>
            <a href="/">Admin</a> ‚ùØ
            </p>
            <h1> PROJECTS </h1>

        </div>
    </section>
  <main class="cards-section">
    <div class="cards-container">
      <div class="cards-grid">

        <!-- Add New Project Card -->
        <div class="card-item add-card" onclick="window.location.href='/admin/projects/new'">
          <span>Ôºã<br>Add Project</span>
        </div>

        <!-- Dynamic Project Cards -->
        {% for project in projects %}
          <div class="card-item admin">
            <div class="card-visual" style="background-image: url('{{ project.cover_image_url }}');"></div>
            <div class="card-subtext">
              {% if project.market and project.service %}
                <h5>{{ project.market }} . {{ project.service }}</h5>
              {% elif project.market %}
                <h5>{{ project.market }}</h5>
              {% elif project.service %}
                <h5>{{ project.service }}</h5>
              {% else %}
                <h5></h5>
              {% endif %}
              <h2 style="text-transform: capitalize ;">{{ project.title or '' }}</h2>
        {% if project.date %}
        <h6 class="project-date">{{ project.formatted_date if project.date else ''}}</h6>
        {% endif %}
            </div>

            <!-- Edit / Delete Icons -->
            <div class="card-actions">
              <i class="feature-star {% if project.feature %}featured{% endif %}"
                       
                              onclick="toggleFeature('{{ project.id }}', this)">
                              {% if project.feature %}‚òÖ{% else %}‚òÜ{% endif %}
            </i>
            <i onclick="window.location.href='/admin/projects/{{ project.id }}'">‚úèÔ∏è</i>
              <i onclick="deleteProject('{{ project.id }}')">üóë</i>

            </div>
          </div>
        {% endfor %}

      </div>
    </div>
  </main>

<script>
    function deleteProject(id) {
        if (confirm("Are you sure you want to delete this project?")) {
            fetch(`/admin/projects/${id}/delete`, {
                method: 'POST'
            }).then(() => {
                location.reload();
            });
        }
    }

function toggleFeature(projectId, starElement) {
    const isCurrentlyFeatured = starElement.textContent === '‚òÖ';
    const action = isCurrentlyFeatured ? 'unfeature' : 'feature';
    
    starElement.style.pointerEvents = 'none';  // prevent double click
  
    fetch(`/admin/projects/${projectId}/feature`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ action: action })
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            starElement.textContent = action === 'feature' ? '‚òÖ' : '‚òÜ';
            starElement.classList.toggle('featured', action === 'feature');
        } else {
            alert(data.message);
        }
    })
    .catch(err => {
        alert('Error: ' + err.message);
    })
    .finally(() => {
        starElement.style.pointerEvents = 'auto';
    });
}
      
</script>
<script> 
//navbar functions
document.addEventListener('DOMContentLoaded', () => {
    let lastScrollTop = 0;
    const navbar = document.querySelector('.navbar');

    const navbarHeight = navbar.offsetHeight;

    window.addEventListener('scroll', () => {
        let scrollTop = window.scrollY || document.documentElement.scrollTop;
        if (scrollTop > navbarHeight) {
            if (scrollTop > lastScrollTop) {
                // Scrolling down
                navbar.classList.add('hide');
                navbar.style.backgroundColor = '#9dadb9';
            } else {
                // Scrolling up
                navbar.classList.remove('hide');


            }
        }

        if (scrollTop === 0) {
            navbar.style.backgroundColor = 'transparent';
        }

        lastScrollTop = scrollTop;
    });
  });


</script>
</body>
</html>
