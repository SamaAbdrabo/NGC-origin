<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- CSS links using Flask's static URL system -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/projects.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/general.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">

    <title>new-GC</title>
</head>
<body>

    <!-- Header Section -->
    <section class="header">
        <nav class="navbar">
            <div class="logo">
                <a href="{{ url_for('home') }}">
                    <img src="{{ url_for('static', filename='photos/logo.jpg') }}" alt="Logo" class="logo-img">
                </a>
            </div>
            <div class="pages">
                <ul>
                            <li><a href="{{ url_for ('about') }}">About Us</a></li>
                            <li><a href="{{ url_for('markets') }}">Markets & Services</a></li>
                            <li><a href="{{ url_for('show_projects') }}">Projects</a></li>
                            <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
                </ul>
            </div>
            <div class="dropdown">
                <div class="menu">
                    <div id="myNav" class="overlay">
                        <a href="javascript:void(0)" class="closebtn">&times;</a>
                    </div>
                    <div>
                        <a href="javascript:void(0)" class="openbtn">
                            <div class="one"></div>
                            <div class="two"></div>
                            <div class="three"></div>
                        </a>
                    </div>
                    <div class="dropdown-content">
                        <ul>
                            <li><a href="{{url_for ('home')}}">Home</a></li>
                            <li><a href="{{ url_for ('about') }}">About Us</a></li>
                            <li><a href="{{ url_for('markets') }}">Markets & Services</a></li>
                            <li><a href="{{ url_for('show_projects') }}">Projects</a></li>
                            <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </section>

    <main>
        <section class="cover-section-2">
            <div class="cover-text-2">
                <h1>PROJECTS</h1>
            </div>
        </section>

        <section class="cards-section">
            <div class="cards-container">
                <div class="projects-filter-area">
              <div class="projects-filter-area">
                    <div class="search-filter">
                    <input type="text" id="searchInput" placeholder="Search projects..." />
                    <div class="filters">
                    <select id="serviceFilter">
                        <option value="all">All Services</option>
                        <option value="infrastructure">Infrastructure</option>
                        <option value="energy">Energy</option>
                        <option value="transport">Transport</option>
                    </select>
                    <select id="marketFilter">
                        <option value="all">All Markets</option>
                        <option value="masterplanning">Masterplanning</option>
                        <option value="Landscape">Landscape</option>
                        <option value="buildings">Buildings</option>
                        <option value="infrastructure">Infrastructure</option>
                        <option value="industrial">Industrial</option>
                        <option value="geotechnical">Geotechical</option>
                        <option value="environmental">Environmental</option>

                    </select>
                    
                    <select id="locationFilter">
                        <option value="all">All Locations</option>
                        <option value="egypt">Egypt</option>
                        <option value="ksa">Saudi Arabia</option>
                    </select>
                    <select id="dateFilter">
                        <option value="all">Date</option>
                        <option value="descending">Descending</option>
                        <option value="ascending">Ascending</option>
                    </select>

                </div>
                <button id="resetBtn" class="reset-button">Reset all filters</button>

                </div>
              </div>
                </div>

                <div class="cards-grid">
                    {% for project in projects %}
                        <a href="/projects/{{project.id}}" class="card-item hover-effect"
                           data-title="{{ project.title | lower }}"
                           data-service="{{ project.service | lower if project.service else '' }}" 
                           data-market="{{ project.market | lower if project.market else '' }}"
                           data-location="{{ project.location | lower if project.location else '' }}"
                           data-date="{{ project.date if project.date else '' }}">
                            <div class="card-visual" style="background-image: url('{{ project.cover_image_url }}');"></div>
                            <div class="card-subtext">
                                
                                {% if project.market and project.service %}
                                <h5 style="text-transform: uppercase;">{{ project.market }} <strong> â€¢ </strong> {{ project.service }}</h5>
                                {% elif project.market %}
                                <h5>{{ project.market }}</h5>
                                {% elif project.service %}
                                <h5>{{ project.service }}</h5>
                                {% else %}
                                <h5></h5>
                                {% endif %}

                                <h2 style="text-transform: capitalize ;">{{ project.title or '' }}</h2>

                                {% if project.date %}
                                <h6 class="project-date">{{project.formatted_date if project.date else ''}}</h6> 
                                {% endif %}
                            </div> 
                        </a>
                    {% else %}
                        <p>No projects available.</p>
                    {% endfor %}
                </div>
            </div>
        </section>
    </main>

    <footer class="footer-container">
        <div class="footer">
            <div class="bottom-logo">
                <a href="/">
                    <img src="{{ url_for('static', filename='photos/logo.jpg') }}" alt="logo" class="logo-img">
                </a>
            </div>
            <div class="footer-content">
                <div class="footer-links">
                    <div class="quick-links">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="{{url_for ('home')}}">Home</a></li>
                            <li><a href="{{ url_for ('about') }}">About Us</a></li>
                            <li><a href="{{ url_for('markets') }}">Markets & Services</a></li>
                            <li><a href="{{ url_for('show_projects') }}">Projects</a></li>
                            <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
                        </ul>
                    </div>
                    <div class="services-links">
                        <h4>Services</h4>
                        <ul>
                            <li><a href="/markets.html#Service-1">Technical and Surveying</a></li>
                            <li><a href="/markets.html#Service-2">Design</a></li>
                            <li><a href="/markets.html#Service-3">Project Management</a></li>
                        </ul>
                    </div>
                </div>
                <div class="contact">
                    <h4>Contact Us</h4>
                    <ul>
                        <a href="https://maps.app.goo.gl/1jGEXui9ujNKSs346" target="_blank"><li>New Gulf Consult, Cairo, Egypt</li></a>
                        <li><strong>Tel:</strong> <a href="tel:+20123456789" target="_blank">+20 123 456 789</a></li>
                        <li><strong>Email:</strong> <a href="mailto:info@ngc.com" target="_blank">info@ngc.com</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 New Gulf Consult. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JS files -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- Inline Scripts (optional: can be moved to separate JS file) -->
    <script>
        // Reset filters
        document.getElementById('resetBtn').addEventListener('click', () => {
            document.getElementById('searchInput').value = '';
            document.getElementById('serviceFilter').value = 'all';
            document.getElementById('marketFilter').value = 'all';
            document.getElementById('locationFilter').value = 'all';
            document.getElementById('dateFilter').value = 'all';
            
            // Show all cards
            document.querySelectorAll('.card-item').forEach(item => {
                item.style.display = 'flex';
            });
            
            // Reset any sorting if applied
            const cardsGrid = document.querySelector('.cards-grid');
            const cards = Array.from(document.querySelectorAll('.card-item'));
            cards.sort((a, b) => {
                return Array.from(cardsGrid.children).indexOf(a) - Array.from(cardsGrid.children).indexOf(b);
            });
            cards.forEach(card => cardsGrid.appendChild(card));
        });

        // Filter and sort functionality
        function filterAndSortCards() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            const selectedService = document.getElementById('serviceFilter').value;
            const selectedMarket = document.getElementById('marketFilter').value;
            const selectedLocation = document.getElementById('locationFilter').value;
            const selectedDateOrder = document.getElementById('dateFilter').value;

            const cards = Array.from(document.querySelectorAll('.card-item'));
            const cardsGrid = document.querySelector('.cards-grid');

            // Filter cards
            cards.forEach(card => {
                const title = card.dataset.title || '';
                const service = card.dataset.service || '';
                const market = card.dataset.market || '';
                const location = card.dataset.location || '';
                const date = card.dataset.date || '';

                const matchesSearch = title.includes(searchValue);
                const matchesService = selectedService === 'all' || service.includes(selectedService);
                const matchesMarket = selectedMarket === 'all' || market.includes(selectedMarket);
                const matchesLocation = selectedLocation === 'all' || location.includes(selectedLocation);

                if (matchesSearch && matchesService && matchesMarket && matchesLocation) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });

            // Sort cards by date if needed
            if (selectedDateOrder !== 'all') {
                const visibleCards = cards.filter(card => card.style.display !== 'none');
                
                visibleCards.sort((a, b) => {
                    const dateA = new Date(a.dataset.date || 0);
                    const dateB = new Date(b.dataset.date || 0);
                    
                    if (selectedDateOrder === 'ascending') {
                        return dateA - dateB;
                    } else {
                        return dateB - dateA;
                    }
                });

                // Reorder cards in DOM
                visibleCards.forEach(card => cardsGrid.appendChild(card));
            }
        }

        // Add event listeners to all filter controls
        document.getElementById('searchInput').addEventListener('input', filterAndSortCards);
        document.getElementById('serviceFilter').addEventListener('change', filterAndSortCards);
        document.getElementById('marketFilter').addEventListener('change', filterAndSortCards);
        document.getElementById('locationFilter').addEventListener('change', filterAndSortCards);
        document.getElementById('dateFilter').addEventListener('change', filterAndSortCards);
    </script>

    <script>
        // Navbar scroll behavior
        document.addEventListener('DOMContentLoaded', () => {
            let lastScrollTop = 0;
            const navbar = document.querySelector('.navbar');
            const navbarHeight = navbar.offsetHeight;

            window.addEventListener('scroll', () => {
                let scrollTop = window.scrollY || document.documentElement.scrollTop;
                if (scrollTop > navbarHeight) {
                    if (scrollTop > lastScrollTop) {
                        navbar.classList.add('hide');
                        navbar.style.backgroundColor = '#9dadb9';
                    } else {
                        navbar.classList.remove('hide');
                    }
                }

                if (scrollTop === 0) {
                    navbar.style.backgroundColor = 'transparent';
                }

                lastScrollTop = scrollTop;
            });
        });
    </script>
</body>
</html>