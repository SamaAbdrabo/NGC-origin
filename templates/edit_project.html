<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Project</title>

  <!-- CSS Links -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/projects-sub.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/general.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/edit_project.css') }}">

  <style>
    .remove-statistic {
      font-size:0.9em;
      background-color: var(--navy_color);
      border-radius:5px 5px;
      border:none;
      color:var(--white);
      padding:0.7em 1em;
    }
    .remove-statisitc:hover {
      background-color: var(--accent);
      transition-duration:0.4s;
    }
  </style>
</head>

<body>
  <!-- View Toggle Button -->
  <button class="admin_button" id="toggleViewBtn" style="position: fixed; top: 1em; left: 1em; z-index: 999;">Plain View</button>

  <!-- Styled View -->
  <main id="styled-view">
    <form action="/admin/projects/{{ project.id }}/edit" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="feature" id="feature-input" value="{{ 'true' if project.feature else 'false' }}">
      
      <!-- Cover Section -->
      <section class="cover-section-2">
        <div class="cover-text-2">
          <p><a href="/admin/home">Admin</a> ❯ <a href="/admin/projects">Projects</a></p>
          <h1><input name="title" style="text-transform: capitalize;" class="editable-input" value="{{ project.title }}"></h1>
        </div>
      </section>

      <!-- Project Info Section -->
      <section class="project-info-section">
        <div class="project-info-main">
          <div class="project-info-description">
            

            <!-- Content Sections -->
            <div class="form-section">
              <h3>Content Sections</h3>
              <div id="sections-container">
                {% for section in project.sections %}
                <div class="section-item" data-id="{{ section.id }}">
                  <select class="section-button" name="section_layout[]">
                    <option value="full-text" {% if section.layout_type=='full-text' %}selected{% endif %}>Full Text</option>
                    <option value="text-image" {% if section.layout_type=='text-image' %}selected{% endif %}>Text + Image</option>
                    <option value="image-text" {% if section.layout_type=='image-text' %}selected{% endif %}>Image + Text</option>
                    <option value="stats" {% if section.layout_type=='stats' %}selected{% endif %}>Statistics</option>
                  </select>
                  <div class="project-info-description">
                    <h1><textarea type="text" name="section_title[]" class="editable-textarea auto-resize"  placeholder="Section title">{{ section.title }}</textarea></h1>
                  </div>
                  <div class="project-info-description-p">
                    <textarea name="section_description[]" class="editable-textarea auto-resize" placeholder="description">{{ section.description or '' }}</textarea>
                  </div>
                  {% if section.layout_type in ['text-image', 'image-text'] %}
                  <div class="card-visual" style="background-image: url('{{ section.image_url }}'); position: relative;">
                    <div class="cover-button general">
                      <button>
                        <label for="section_image_{{ section.id }}">{% if section.image_url %}Change image{% else %}Upload image{% endif %}</label>
                        <input type="file" name="section_image_{{ section.id }}" id="section_image_{{ section.id }}" accept="image/*">
                      </button>
                    </div>
                  </div>
                  {% endif %}
                  <input type="number" name="section_order[]" value="{{ section.order }}" placeholder="Order">
                  <button type="button" class="remove-section admin_button">Remove</button>
                </div>
                {% endfor %}
              </div>
              <button type="button" class="admin_button" id="add-section">+ Add Section</button>
            </div>

            <!-- Featured Description Section -->
            <div class="form-section">
              <h3>Featured Description (visible only in homepage)</h3>
              <textarea name="featured_description" placeholder="limit to a few lines" class="editable-textarea auto-resize">{{ project.featured_description or '' }}</textarea>
            </div>

            <!-- Statistics Section -->
            <div class="form-section">
              <h3>Project Statistics</h3>
              <div id="statistics-container">
                {% for stat in project.statistics %}
                <div class="statistic-item">
                  <div>
                    <input type="text" class="stat_value editable-input" name="stat_value[]" value="{{ stat.value }}" placeholder="Value">
                    <input type="text" class="stat_unit editable-input" name="stat_unit[]" value="{{ stat.unit }}" placeholder="Unit (optional)">
                  </div>
                  <input type="text" class="stat_title editable-input" name="stat_title[]" value="{{ stat.title }}" placeholder="Statistic title">
                  <input type="number" class="stat_order" name="stat_order[]" value="{{stat.order}}" placeholder="order displayed">
                  <button type="button" class="remove-statistic">Remove</button>
                </div>
                {% endfor %}
              </div>
              <button type="button" class="admin_button" id="add-statistic">+ Add Statistic</button>
            </div>
          </div>
        </div>
        
        <!-- Project Info Panel -->
        <div class="project-info-panel">
          {% if project.service or True %}
          <div class="project-info-panel-div">
            <h5><input name="service" class="editable-input" style="text-transform: uppercase;" placeholder="SERVICE" value="{{ project.service or '' }}"></h5>
          </div>
          {% endif %}

          {% if project.market or True %}
          <div class="project-info-panel-div">
            <h4>MARKET</h4>
            <div class="project-info-panel-div-p">
              <input name="market" class="editable-input" value="{{ project.market or '' }}">
            </div>
          </div>
          {% endif %}
          
          {% if project.location or True %}
          <div class="project-info-panel-div">
            <h4>LOCATION</h4>
            <div class="project-info-panel-div-p">
              <input name="location" class="editable-input" value="{{ project.location or '' }}">
            </div>
          </div>
          {% endif %}

          {% if project.client or True %}
          <div class="project-info-panel-div">
            <h4>CLIENT</h4>
            <div class="project-info-panel-div-p">
              <input name="client" class="editable-input" value="{{ project.client or '' }}">
            </div>
          </div>
          {% endif %}

          {% if project.collaboration or True %}
          <div class="project-info-panel-div">
            <h4>COLLABORATION</h4>
            <div class="project-info-panel-div-p">
              <input name="collaboration" class="editable-input" value="{{ project.collaboration or '' }}">
            </div>
          </div>
          {% endif %}

          {% if project.date or True %}
          <div class="project-info-panel-div">
            <h4>Project Date</h4>
            <input name="date" type="date" placeholder="Date" class="editable-input" value="{{project.date.strftime('%Y-%m-%d') if project.date else '' }}" />
          </div>
          {% endif %}

          {% if project.completion_date or True %}
          <div class="project-info-panel-div">
            <h4>COMPLETION DATE</h4>
            <div class="project-info-panel-div-p">
              <input name="completion_date" type="date" class="editable-input" value="{{ project.completion_date.strftime('%Y-%m-%d') if project.completion_date else '' }}">
            </div>
          </div>
          {% endif %}

          <div style="margin-top: 2em;">
            <button type="button" onclick="addPanelField()">+ Add Info Section</button>
          </div>
        </div>
      </section>

      <input type="file" class="editable-input" name="section_image" id="section_image" accept="image/*" style="display:none">
      <input type="file" class="editable-input" name="cover_image" id="cover_image" accept="image/*" style="display:none">

      <div class="general" style="text-align:center; margin:2em;">
        <button type="submit">Save Changes</button>
      </div>
    </form>

    <!-- Floating Preview Card -->
    <div id="floating-card" class="card-item hover-effect" style="position: fixed; top: 2em; right: 2em; z-index: 9999; cursor: move;">
      <!-- Cover Image Upload Area -->
      <div class="card-visual" id="preview-image" style="background-image: url('{{ project.cover_image_url }}'); position: relative;">
        {% if project.cover_image_url %} 
        <div class="cover-button general">
          <button>
            <label for="cover_image">change cover</label>
            <input type="file" class="editable-input" name="cover_image" id="cover_image" accept="image/*">
          </button>
        </div>
        {% else %}
        <div class="cover-button general">
          <button>
            <label for="cover_image">upload an image</label>
            <input type="file" class="editable-input" name="cover_image" id="cover_image" accept="image/*">
          </button>
        </div>
        {% endif %}
      </div>
      <div class="card-subtext">
        <h5 style="display: flex; align-items: center;">
          <input id="preview-market" value="{{ project.market }}" style="text-transform: uppercase;" placeholder="Market" class="editable-input" />
          {% if project.market and project.service %} {% endif %}
          <input id="preview-service" value="{{ project.service or '' }}" style="text-transform: uppercase;" placeholder="Service" class="editable-input" />
        </h5>

        <h2 style="text-transform: capitalize;"><input id="preview-title" value="{{ project.title }}" class="editable-input"/></h2>

        <h6 class="project-date">
          <input name="date" id="preview-date" type="date" placeholder="Date" class="editable-input" value="{{ project.date.strftime('%Y-%m-%d') if project.date else '' }}" />
        </h6>
        <div class="card-actions">
          <i class="feature-star {% if project.feature %}featured{% endif %}"                       
            onclick="toggleFeature('{{ project.id }}', this)">
            {% if project.feature %}★{% else %}☆{% endif %}
          </i>
        </div>
      </div>

      <button id="collapse-btn" style="position:absolute; top:5px; right:5px;background-color: var(--white); border:none;width:1em;height:1em; font-size:2em; cursor:pointer;">-</button>
    </div>
  </main>

  <!-- Plain View Form -->
  <form id="plain-view" action="/admin/projects/{{ project.id }}/edit" method="POST" enctype="multipart/form-data" style="display:none; max-width: 900px; margin: auto; padding: 3em; background: #f7f7f7; border-radius: 10px;">
    <h1>Edit Project (Plain View)</h1>

    <label class="plain_label" for="title">Project Title</label>
    <input class="plain_input" type="text" name="title" value="{{ project.title or '' }}" required>


    <label class="plain_label" style="font-size: 1.5em;">Content</label>
              <div id="sections-container">
                {% for section in project.sections %}
                <div class="section-item" style="gap:0" data-id="{{ section.id }}">
                  <select class="section-button" name="section_layout[]">
                    <option value="full-text" {% if section.layout_type=='full-text' %}selected{% endif %}>Full Text</option>
                    <option value="text-image" {% if section.layout_type=='text-image' %}selected{% endif %}>Text + Image</option>
                    <option value="image-text" {% if section.layout_type=='image-text' %}selected{% endif %}>Image + Text</option>
                    <option value="stats" {% if section.layout_type=='stats' %}selected{% endif %}>Statistics</option>
                  </select>
                    <label class="plain_label" for="subtitle">Subtitle</label>
                    <input type="text" class="plain_input" name="section_title[]"  value="{{ section.title }}" >

                  <label class="plain_label" for="description">Description</label>
                  <textarea class="plain_input" name="section_description[]" rows="8">{{ section.description or '' }}</textarea>

                  {% if section.layout_type in ['text-image', 'image-text'] %}
                  <div class="card-visual section-img-visual" style="background-image: url('{{ section.image_url }}'); position: relative;">
                    <div class="cover-button general">
                      <button>
                        <label for="section_image_{{ section.id }}">{% if section.image_url %}Change image{% else %}Upload image{% endif %}</label>
                        <input type="file" name="section_image_{{ section.id }}" id="section_image_{{ section.id }}" accept="image/*">
                      </button>

                    </div>
                  </div>
                  {% endif %}
                  <label class="plain_label" for="order">Order</label>
                  <input type="number" class="plain_input" name="section_order[]" value="{{ section.order }}" placeholder="Order">
                  <button type="button"  style="margin-top:1.2em" class="remove-section admin_button">Remove</button>
                </div>
                {% endfor %}
              </div>
              <button type="button" class="admin_button" style="margin-top:2em; width: 100%;" id="add-section">+ Add Section</button>
            </div>

    <label class="plain_label" style="font-size: 1.5em;">Panel Section  </label>

    <label class="plain_label" for="service">Service</label>
    <input class="plain_input" type="text" name="service" value="{{ project.service or '' }}">

    <label class="plain_label" for="market">Market</label>
    <input class="plain_input" type="text" name="market" value="{{ project.market or '' }}">

    <label class="plain_label" for="location">Location</label>
    <input class="plain_input" type="text" name="location" value="{{ project.location or '' }}">

    <label class="plain_label" for="client">Client</label>
    <input class="plain_input" type="text" name="client" value="{{ project.client or '' }}">

    <label class="plain_label" for="collaboration">Collaboration</label>
    <input class="plain_input" type="text" name="collaboration" value="{{ project.collaboration or '' }}">

    <label class="plain_label" for="date">Project Date</label>
    <input class="plain_input" type="date" name="date" value="{{ project.date.strftime('%Y-%m-%d') if project.date else '' }}">

    <label class="plain_label" for="completion_date">Completion Date</label>
    <input class="plain_input" type="date" name="completion_date" value="{{ project.completion_date.strftime('%Y-%m-%d') if project.completion_date else '' }}">
           <!-- Statistics Section -->
              <label class="plain_label" style="font-size: 1.5em;">Project Statistics</label>
              <div id="statistics-container">
                {% for stat in project.statistics %}
                <div class="statistic-item plain-stat-item" >
                  <div>
                    <input type="text" class="stat_value plain_input" name="stat_value[]" value="{{ stat.value }}" placeholder="Value">
                    <input type="text" class="stat_unit plain_input" name="stat_unit[]" value="{{ stat.unit }}" placeholder="Unit (optional)">
                  </div>
                  <input type="text" class="stat_title plain_input" name="stat_title[]" value="{{ stat.title }}" placeholder="Statistic title">
                  <input type="number" class="stat_order plain_input" name="stat_order[]" value="{{stat.order}}" placeholder="order displayed">
                  <button type="button" class="remove-statistic">Remove</button>
                </div>
                {% endfor %}
              </div>
              <button type="button" class="admin_button" style="width: 100%; margin-top: 2em" id="add-statistic">+ Add Statistic</button>
            </div>
          </div>
        </div>
        
    <label class="plain_label" style="font-size: 1.5em;" for="cover_image">Change Cover Image</label>
    <input class="plain_input" type="file" name="cover_image" accept="image/*">

    <label class="plain_label" for="feature">
      Feature Project
      
      <input class="plain_input" type="checkbox" name="feature" value="true" {% if project.feature %}checked{% endif %}>
    </label>

    <label class="plain_label">Featured Description (visible only in homepage)</label>
    <textarea name="featured_description" placeholder="limit to a few lines" class="plain_input auto-resize">{{ project.featured_description or '' }}</textarea>

    <button class="admin_button" style="margin-top:2em; width:100%; align-items: center;" type="submit">Save Changes</button>
  </form>

  <!-- JavaScript -->
  <script>
    // View Toggle
    const toggleBtn = document.getElementById('toggleViewBtn');
    const styledView = document.getElementById('styled-view');
    const plainView = document.getElementById('plain-view');

    toggleBtn.addEventListener('click', () => {
      const isPlain = plainView.style.display === 'block';
      styledView.style.display = isPlain ? 'block' : 'none';
      plainView.style.display = isPlain ? 'none' : 'block';
      toggleBtn.textContent = isPlain ? 'Plain View' : 'Styled View';
    });

    // Add Panel Field
    function addPanelField() {
      const panel = document.querySelector('.project-info-panel');
      
      const fieldWrapper = document.createElement('div');
      fieldWrapper.className = 'project-info-panel-div';

      const heading = prompt("Enter field label (e.g., ARCHITECT, SUPERVISOR):");
      const name = heading.toLowerCase().replace(/\s+/g, "_");

      if (!heading) return;

      fieldWrapper.innerHTML = `
        <h3>${heading}</h3>
        <div class="project-info-panel-div-p">
          <input name="${name}" class="editable-input" placeholder="${heading}">
          <button type="button" onclick="this.closest('.project-info-panel-div').remove()">Remove</button>
        </div>
      `;
      
      const addBtnWrapper = panel.querySelector('div[style*="margin-top"]');
      panel.insertBefore(fieldWrapper, addBtnWrapper);
    }

    // Input Sync
    function syncTriple(fieldName) {
      const styled = document.querySelector(`#styled-view [name="${fieldName}"]`);
      const plain = document.querySelector(`#plain-view [name="${fieldName}"]`);
      const preview = document.getElementById(`preview-${fieldName}`);

      const updateAll = (sourceEl) => {
        const val = sourceEl.value;

        [styled, plain, preview].forEach(el => {
          if (el && el !== sourceEl) {
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
              el.value = val;
            } else {
              el.textContent = val;
            }
          }
        });
      };

      [styled, plain, preview].forEach(el => {
        if (el) el.addEventListener('input', () => updateAll(el));
      });

      if (styled && plain) plain.value = styled.value;
      if (styled && preview) {
        if (preview.tagName === 'INPUT') preview.value = styled.value;
        else preview.textContent = styled.value;
      }
    }

    // Sync fields
    [
      'title', 'subtitle', 'description',
      'service', 'market', 'location',
      'client', 'collaboration', 'date',
      'completion_date','feature','featured_description', 'stat_value[]', 'stat_unit[]','stat_title[]','stat_order[]'
    ].forEach(syncTriple);

    // Cover Image Sync
    const styledCover = document.querySelector(`#styled-view input[name="cover_image"]`);
    const plainCover = document.querySelector(`#plain-view input[name="cover_image"]`);
    const previewImage = document.getElementById('preview-image');

    function updateCoverImagePreview(file) {
      const reader = new FileReader();
      reader.onload = e => {
        previewImage.style.backgroundImage = `url('${e.target.result}')`;
      };
      reader.readAsDataURL(file);
    }

    function syncCoverImage(input, source) {
      input.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        updateCoverImagePreview(file);

        const other = input === styledCover ? plainCover : styledCover;
        if (other) other.files = e.target.files;
      });
    }

    if (styledCover) syncCoverImage(styledCover);
    if (plainCover) syncCoverImage(plainCover);

    // Feature Toggle
    
  

    const styledFeature = document.querySelector('#styled-view input[name="feature"]');
    const plainFeature = document.querySelector('#plain-view input[name="feature"]');
    const previewStar = document.querySelector('.feature-star');
    const featureInput = document.getElementById('feature-input');

    function setFeatureState(checked) {
        const isFeatured = featureInput.value === 'true';

      if (styledFeature) styledFeature.checked = checked;
      if (plainFeature) plainFeature.checked = checked;
      if (featureInput) featureInput.value = checked ? 'true' : 'false';

      if (previewStar) {
        previewStar.classList.toggle('featured', checked);
        previewStar.textContent = checked ? '★' : '☆';
      }
    }
    
    // Listen to all feature checkboxes
document.addEventListener('change', (e) => {
  if (e.target && e.target.name === 'feature') {
    setFeatureState(e.target.checked);
  }
});
// On load: sync initial value
window.addEventListener('DOMContentLoaded', () => {
  const initialState = styledFeature?.checked || plainFeature?.checked || false;
  setFeatureState(initialState);
});
    if (styledFeature) styledFeature.addEventListener('change', () => setFeatureState(styledFeature.checked));
    if (plainFeature) plainFeature.addEventListener('change', () => setFeatureState(plainFeature.checked));

    if (previewStar) {
      previewStar.addEventListener('click', () => {
        const newState = !previewStar.classList.contains('featured');
        setFeatureState(newState);
      });
    }
    
    // Floating Card Drag
    const floatingCard = document.getElementById("floating-card");
    let isDragging = false, offsetX = 0, offsetY = 0;

    floatingCard.addEventListener("mousedown", e => {
      isDragging = true;
      offsetX = e.clientX - floatingCard.getBoundingClientRect().left;
      offsetY = e.clientY - floatingCard.getBoundingClientRect().top;
    });

    document.addEventListener("mousemove", e => {
      if (isDragging) {
        floatingCard.style.left = `${e.clientX - offsetX}px`;
        floatingCard.style.top = `${e.clientY - offsetY}px`;
        floatingCard.style.bottom = 'unset';
        floatingCard.style.right = 'unset';
      }
    });

    document.addEventListener("mouseup", () => isDragging = false);

    // Collapse Functionality
    const collapseBtn = document.getElementById("collapse-btn");
    let collapsed = false;
    collapseBtn.addEventListener("click", () => {
      collapsed = !collapsed;
      floatingCard.style.height = collapsed ? "4em" : "30em";
      floatingCard.querySelector(".card-subtext").style.display = collapsed ? "none" : "flex";
      floatingCard.querySelector(".card-visual").style.height = collapsed ? "100%" : "100%";
      collapseBtn.textContent = collapsed ? "+" : "-";
    });

    // Textarea Auto-resize
    function resizeTextarea(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = `${textarea.scrollHeight}px`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const textareas = document.querySelectorAll('.auto-resize');
      
      textareas.forEach(ta => {
        resizeTextarea(ta);
        ta.addEventListener('input', () => resizeTextarea(ta));
      });
    });

    // Statistics Management
// Replace the existing Statistics Management code with this:
document.addEventListener('click', (e) => {
  if (e.target && e.target.id === 'add-statistic') {
    const container = e.target.closest('form').querySelector('#statistics-container');
    const newStat = document.createElement('div');
    newStat.className = 'statistic-item';
    
    if (e.target.closest('#plain-view')) {
      // Plain view statistic template
          newStat.className = 'statistic-item plain-stat-item';

      newStat.innerHTML = `
                    <div>
                      <input type="text" class=" plain_input" name="stat_value[]" placeholder="Value">
                      <input type="text" class=" plain_input" name="stat_unit[]"  placeholder="Unit (optional)">
                    </div>
                    <input type="text" class=" plain_input" name="stat_title[]"  placeholder="Statistic title">
                    <input type="number" class=" plain_input" name="stat_order[]"  placeholder="order displayed">
                    <button type="button" class="remove-statistic">Remove</button>
          
                
      
      `;

    } else {
      // Styled view statistic template
      newStat.innerHTML = `
        <div>
          <input type="text" class="stat_value editable-input" name="stat_value[]" placeholder="Value">
          <input type="text" class="stat_unit editable-input" name="stat_unit[]" placeholder="Unit (optional)">
        </div>
        <input type="text" class="stat_title editable-input" name="stat_title[]" placeholder="Statistic title">
        <input type="number" class="stat_order" name="stat_order[]" placeholder="order displayed">
        <button type="button" class="remove-statistic">Remove</button>
      `;
    }
    
    container.appendChild(newStat);
  }
});

document.addEventListener('click', (e) => {
  if (e.target && e.target.id === 'add-section') {
    const container = e.target.closest('form').querySelector('#sections-container');
    const newSection = document.createElement('div');
    newSection.className = 'section-item';
    
    if (e.target.closest('#plain-view')) {
      // Plain view section template
      
        newSection.className = 'section-item plain-section-item' ;
              newSection.innerHTML =

 `


        <select  name="section_layout[]">
          <option value="full-text">Full Text</option>
          <option value="text-image">Text + Image</option>
          <option value="image-text">Image + Text</option>
          <option value="stats">Statistics</option>
        </select>
        <label class="plain_label" for="subtitle">Subtitle</label>
        <input type="text" class="plain_input" name="section_title[]" placeholder="Section title">
        <label class="plain_label" for="description">Description</label>
        <textarea name="section_description[]" class="plain_input" placeholder="Section content"></textarea>
        <div class="section-image-upload" style="display:none; ">
          <div class="section-image-upload-controls ">
            <label>Section Image:</label>
            <input type="file" name="new_section_image[]" accept="image/*">
          </div>
        </div>
        <label class="plain_label" for="order">Order</label>
        <input type="number" class="plain_input" name="section_order[]" placeholder="Order">
        <button type="button" style="margin-top:1.2em" class="remove-section admin_button">Remove</button>
      `;
    } else {
      // Styled view section template
      newSection.innerHTML = `
        <select name="section_layout[]">
          <option value="full-text">Full Text</option>
          <option value="text-image">Text + Image</option>
          <option value="image-text">Image + Text</option>
          <option value="stats">Statistics</option>
        </select>
        <div class="project-info-description">
          <h1><input type="text" name="section_title[]" class="editable-input" placeholder="Section title"></h1>
        </div>
        <div class="project-info-description-p">
          <textarea name="section_description[]" class="editable-textarea" placeholder="description"></textarea>
        </div>
        <input type="number" name="section_order[]" placeholder="Order">
        <button type="button" class="remove-section admin_button">Remove</button>
      `;
    }
    
    container.appendChild(newSection);
    
    // Handle layout change to show/hide image upload
    const select = newSection.querySelector('select');
    select.addEventListener('change', function() {
      const imageUpload = newSection.querySelector('.section-image-upload');
      if (imageUpload) {
        imageUpload.style.display = 
          (this.value === 'text-image' || this.value === 'image-text') ? 'block' : 'none';
      }
    });
  }
});
    // Event Delegation for Remove Buttons
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('remove-statistic')) {
        e.target.closest('.statistic-item').remove();
      }
      if (e.target.classList.contains('remove-section')) {
        e.target.closest('.section-item').remove();
      }
      if (e.target && e.target.name === 'section_layout[]') {
  const sectionItem = e.target.closest('.section-item');
  const imageUpload = sectionItem.querySelector('.section-image-upload');
  if (imageUpload) {
    imageUpload.style.display = 
      (e.target.value === 'text-image' || e.target.value === 'image-text') ? 'block' : 'none';
  }
}
    });

    // Toggle Feature
    function toggleFeature(projectId, starElement) {
      const isCurrentlyFeatured = starElement.textContent === '★';
      const action = isCurrentlyFeatured ? 'unfeature' : 'feature';
      const featureInput = document.getElementById('feature-input');
      
      starElement.style.pointerEvents = 'none';
    
      fetch(`/admin/projects/${projectId}/feature`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ action: action })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          starElement.textContent = action === 'feature' ? '★' : '☆';
          starElement.classList.toggle('featured', action === 'feature');
          featureInput.value = action === 'feature' ? 'true' : 'false';
        } else {
          alert(data.message);
        }
      })
      .catch(err => {
        alert('Error: ' + err.message);
      })
      .finally(() => {
        starElement.style.pointerEvents = 'auto';
      });
    }
  </script>
  
</body>
</html>